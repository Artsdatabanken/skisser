<div class="child">

    <h2 *ngIf="pageTitle$ | async as pageTitle">{{ pageTitle }}</h2>

    <div class="section">

        <!--toppobservatører-->

        <h3>{{ 'shared.filter' | translate }}</h3>

        <div class="filter">

            <!--years-->

            <select name="yearSelector" id="years" [(ngModel)]="selected.year"
                (ngModelChange)="onYearSelection($event)">

                <option [ngValue]="null">
                    {{ 'shared.select_years' | translate }}
                </option>

                <option [value]="year" *ngFor="let year of years">
                    {{ year }}
                </option>

            </select>

            <!--years-->

            <!--species groups-->

            <select name="speciesGroupsSelector" id="speciesGroups" [(ngModel)]="selected.speciesGroup"
                (ngModelChange)="onSpeciesGroupSelection($event)">

                <option [ngValue]="null">
                    {{ 'shared.select_speciesGroups' | translate }}
                </option>

                <option [value]="sg.id" *ngFor="let sg of speciesGroups$ | async">
                    <ng-container *ngIf="currentLanguage$ | async as currentLanguage">
                        {{ currentLanguage === 'no' ? sg.no : sg.en }}
                    </ng-container>
                </option>

            </select>

            <!--species groups-->

            <!--taxon-->

            <div class="search-box">

                <!-- <input class="search-box__input" [ngClass]="{'search-box__input--active': showTaxonPane}" #taxon
                    (keyup)="getTaxon(taxon.value)" placeholder="Søk takson">     -->

                <input class="search-box__input" [ngModel]="selected.taxon" #taxon (keyup)="getTaxon(taxon.value)"
                    placeholder="Søk takson">

                <div class="search-box__field" [ngClass]="{'search-box__field--show': showTaxonPane}"
                    *ngIf="taxons$ | async as taxons">

                    <div class="search-box__stripe" *ngFor="let taxon of taxons" (click)="onTaxonSelection(taxon)">

                        <h2>
                            <span [ngClass]="{'text-italics': taxon.taxonCategoryId > 13}">
                                {{ taxon.scientificName.name }}
                            </span>

                            <small class="text-uppercase" *ngIf="taxon.scientificName.author">
                                {{ taxon.scientificName.author }}
                            </small>
                        </h2>
                        <h3>
                            {{ taxon.vernacularName?.name | lowercase }}
                            <small class="text-uppercase" *ngIf="taxon.vernacularName?.author">
                                {{ taxon.vernacularName.author }}
                            </small>
                        </h3>

                        <div class="search-box__details">

                            <span class="tag"
                                *ngIf="taxon.scientificNameSynonyms.length > 0 || taxon.vernacularNameSynonyms.length > 0">
                                {{ 'shared.synonyms' | translate }}
                            </span>

                            <ng-container *ngIf="taxon.scientificNameSynonyms.length > 0">

                                <div *ngFor="let synonym of taxon.scientificNameSynonyms">
                                    <small [ngClass]="{'text-bold': synonym.isSearchMatch}"><i> {{ synonym.name }}
                                        </i></small>
                                </div>

                            </ng-container>

                            <ng-container *ngIf="taxon.vernacularNameSynonyms.length > 0">

                                <div *ngFor="let synonym of taxon.vernacularNameSynonyms">
                                    <small [ngClass]="{'text-bold': synonym.isSearchMatch}"> {{ synonym.name }} </small>
                                </div>

                            </ng-container>

                        </div>

                    </div>

                    <div class="search-box__stripe" *ngIf="taxons.length === 0">
                        {{ 'shared.noHits' | translate }}
                    </div>

                </div>

            </div>

            <!--taxon-->
            <!--area-->

            <div class="search-box">

                <!-- <input class="search-box__input" [ngModel]="selectedArea" #area (keyup)="getArea(area.value)"
                    placeholder="Søk område">   -->

                <input class="search-box__input" [ngModel]="selected.area" #area (keyup)="getArea(area.value)"
                    placeholder="Søk område">

                <div class="search-box__field" [ngClass]="{'search-box__field--show': showAreaPane}"
                    *ngIf="areas$ | async as areas">
                    <div class="search-box__stripe" *ngFor="let area of areas"
                        (click)="onAreaSelection(area.id, area.name)">

                        <h2>
                            <span> {{ area.name }} {{ area.id }}</span>
                            <ng-container *ngIf="area.name == 'Oslo'">
                                <small *ngIf="area.type == areaType.county">
                                    ({{ 'shared.area_county' | translate | lowercase }})
                                </small>
                            </ng-container>
                        </h2>

                    </div>
                </div>

            </div>

            <!--area-->

        </div>

        <br>
        <br>

        <div *ngIf="selected">

            <small>{{ 'shared.search_chosenFilters' | translate }}: </small>

            <ng-container *ngFor="let prop of selected | keyvalue">

                <button class="button button--xs button--close" *ngIf="prop.value !== null"
                    (click)="resetFilter(prop.key)">
                    <!-- {{ prop.value }} -->

                    <ng-container *ngIf="prop.key !== 'speciesGroup'">
                        {{ prop.value }}
                    </ng-container>

                    <ng-container *ngIf="prop.key === 'speciesGroup'">
                        <app-species-group [speciesGroupId]="prop.value"></app-species-group>
                    </ng-container>

                </button> &nbsp;

            </ng-container>

            <button class="button button--xs button--close" (click)="resetFilters()">
                {{ 'shared.resetFilters' | translate }}
            </button>

        </div>

        <br>
        <br>

        <div *ngIf="filteredData$ | async as userStatistics">

            <ng-container *ngIf="userStatistics.totalCount === 0">
                {{ 'shared.noResults' | translate }}
                <br><br>
            </ng-container>

            <div class="stripe stripe--dummy" *ngIf="userStatistics.totalCount > 0">

                <div class="stripe__cell">
                    {{ 'statistics.userStats_position' | translate }}
                </div>
                <div class="stripe__cell">
                    {{ 'statistics.userStats_observer' | translate }}
                </div>
                <div class="stripe__cell">
                    {{ 'statistics.userStats_sightingsCount' | translate }}
                </div>

            </div>

            <ng-container *ngFor="let topObserver of userStatistics.topObservers; let i = index">

                <app-user-stats-stripe [position]="getPosition(i, userStatistics.pageNumber, userStatistics.pageSize)"
                    [topObserver]="topObserver">
                </app-user-stats-stripe>

            </ng-container>

        </div>

        <br><br><br><br>

        <app-pagination *ngIf="totalPages$ | async as totalPages" [totalPages]="totalPages"
            (switchedPage)="onPaginationClick($event)"></app-pagination>


        <br>
        <br>
        <br>
        <br>

        <!-- <div class="grid grid--3">

            <div class="grid__cell">

                <app-total-count-statistics [statistics]="totalCountStatistics.totalSightings" [style]="'list'"
                    [text]="'statistics.overviewNumbers_sightings' | translate" [icon]="true" [size]="'sm'">
                </app-total-count-statistics>

            </div>

            <div class="grid__cell">

                <div class="stats">
                    <div class="stats__text">Du er på</div>
                    <div class="stats__number stats__number--main"><span class="badge badge--xl">374</span></div>
                    <div class="stats__text"> plass med <strong>1784</strong>
                        <br>
                        rapporterte observasjoner
                    </div>
                </div>
                <br>
                <div style="text-align: center;"><small style="font-size: 16px;">Se <a href="">din
                            statistikk</a></small></div>

            </div>

            <div class="grid__cell">

                <app-total-count-statistics [statistics]="totalCountStatistics.totalUsers" [style]="'list'"
                    [text]="'statistics.overviewNumbers_users' | translate" [icon]="true" [size]="'sm'">
                </app-total-count-statistics>

            </div>

        </div> -->

        <!---->

    </div>

</div>